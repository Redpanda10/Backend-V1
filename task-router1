const express =require('express')
const Task = require('./model/task')


const router =express.Router()


router.get("/task",async (req,res)=>{
    try{
        const task = await Task.find()
        res.json(task)
    }catch(err){
        res.json({
            message:"Error fetching task",
            error:err.message
        })
    }
})

router.post("/task", async(req,res)=>{
    try{
        const body= req.body
        const task = new Task(body)
        const newtask = await task.save()
        res.json(newtask)
    }catch(err){
        res.json({message:"failed to add task",
            error: err.message
        })
    }
})

router.get('/:id',async(req,res)=>{
    try{
        const id = req.params.id
        if(!id) res.json({message:'Task not found'})
        const task = await Task.findById(id)
        res.send("Deleted Sucessfully")

    }catch(err){
        res.json({
            message:"Task not deleted",
            error:err.message
        })
    }
})

router.delete('/:id',async(req,res)=>{
    try{
        const deletedTask = await Task.findByIdAndRemove(req.params.id)
        if(!deletedTask) res.json({message:'Task not found'})
        res.json('Deleted sucessfully')    
        }catch(err){
            res.json({
                message:"Task not deleted",
                error:err.message
            })
        }
})
module.exports = router;
